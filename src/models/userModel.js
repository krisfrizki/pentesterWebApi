const {Pool} = require('pg');
const config = require('../../config');

const pool = new Pool(config.pgConfig);

const registerUserModel = async (username, email, password) => {
    try {
        const existingUser = await pool.query('SELECT * FROM users WHERE email = $1', [email]);
        if (existingUser.rows.length > 0) {
            return {
                status: false,
                message: 'Email sudah penah digunakan'
            }
        } else {
            await pool.query('INSERT INTO users (username, email, password) VALUES ($1, $2, $3)', [username, email, password]);
            return {
                status: true,
                message: 'registrasi sukses'
            }
        }
    } catch (error) {
        console.log('Kesalahan pada registrasi user', error);
        return {
            status: false,
            message: 'kesalahan server internal'
        }
    }
};

const checkUsernameExist = async username => {
    const result = await pool.query('SELECT * FROM users WHERE username = $1', [username]);
    return result.rows.length > 0;
};

module.exports = {
    registerUserModel,
    checkUsernameExist
}